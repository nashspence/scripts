#!/bin/sh

set -eu
[ -n "${DEBUG:-}" ] && set -x

die() {
  printf '%s\n' "$*" >&2
  exit 2
}

main() {
  shortcuts="$HOME/.config/podman-scripts/shortcuts_path.zsh"
  [ -r "$shortcuts" ] || die "Missing shortcuts file: $shortcuts"

  # shellcheck source=/dev/null  # dynamic user config path
  . "$shortcuts"

  src="${1:-}"
  [ -n "$src" ] || die "No input directory path provided"
  [ -r "$src" ] || die "Input not readable: $src"

  rname="${2:-}"
  [ -n "$rname" ] || die "No record name provided"
  [ -r "$rname" ] || die "Record name not readable: $rname"

  command -v caffeinate >/dev/null 2>&1 || die "caffeinate not found"
  command -v birthrname >/dev/null 2>&1 || die "birthrname not found"
  command -v rpush      >/dev/null 2>&1 || die "rpush not found"

  caffeinate -dims -w $$ &
  birthrname "$src"
  rpush move "$src/" "smb://0819870.xyz/convert/$rname/"
}

main "$@"
